<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="J. Gałecki" />


<title>Lab 3</title>

<script src="site_libs/header-attrs-2.29.1/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.1/jquery-3.6.1.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CCFD Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Info I
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="info1_regulamin.html">Regulamin przedmiotu</a>
    </li>
    <li>
      <a href="https://github.com/ccfd/courses_graphics/archive/master.zip">Projekt z biblioteką graficzną</a>
    </li>
    <li>
      <a href="info1_tworzenie_projektu.html">Instrukcja tworzenia projektu</a>
    </li>
    <li>
      <a href="info1_lab01.html">Instrukcja I</a>
    </li>
    <li>
      <a href="info1_lab02.html">Instrukcja II</a>
    </li>
    <li>
      <a href="info1_lab03.html">Instrukcja III</a>
    </li>
    <li>
      <a href="info1_lab04.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="info1_lab05.html">Instrukcja V</a>
    </li>
    <li>
      <a href="info1_lab06.html">Instrukcja VI</a>
    </li>
    <li>
      <a href="info1_lab07.html">Instrukcja VII</a>
    </li>
    <li>
      <a href="info1_lab08.html">Instrukcja VIII</a>
    </li>
    <li>
      <a href="info1_lab09.html">Instrukcja IX</a>
    </li>
    <li>
      <a href="info1_lab10.html">Instrukcja X</a>
    </li>
    <li>
      <a href="info1_arkusz_kalkulacyjny.html">Arkusz kalkulacyjny</a>
    </li>
    <li>
      <a href="info1_projekty.html">Projekty</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Info II
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="info2_regulamin.html">Regulamin</a>
    </li>
    <li>
      <a href="info2_lab01.html">Instrukcja I</a>
    </li>
    <li>
      <a href="info2_lab02.html">Instrukcja II</a>
    </li>
    <li>
      <a href="info2_lab03.html">Instrukcja III</a>
    </li>
    <li>
      <a href="info2_lab04.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="info2_lab05.html">Instrukcja V</a>
    </li>
    <li>
      <a href="info2_lab06.html">Instrukcja VI</a>
    </li>
    <li>
      <a href="info2_training_exercises.html">Zadania treningowe</a>
    </li>
    <li>
      <a href="info2_projekty.html">Zadania domowe</a>
    </li>
    <li>
      <a href="info2_raport.html">Raport</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    CS I
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="cs1_rules.html">Rules</a>
    </li>
    <li>
      <a href="cs1_lab01.html">Instruction I</a>
    </li>
    <li>
      <a href="cs1_lab02.html">Instruction II</a>
    </li>
    <li>
      <a href="cs1_lab03.html">Instruction III</a>
    </li>
    <li>
      <a href="cs1_lab04.html">Instruction IV</a>
    </li>
    <li>
      <a href="cs1_lab05.html">Instruction V</a>
    </li>
    <li>
      <a href="cs1_lab06.html">Instruction VI</a>
    </li>
    <li>
      <a href="cs1_lab07.html">Instruction VII</a>
    </li>
    <li>
      <a href="cs1_lab08.html">Instruction VIII</a>
    </li>
    <li>
      <a href="cs1_lab09.html">Instruction IX</a>
    </li>
    <li>
      <a href="cs1_spreadsheet.html">Spreadsheet</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    CS II
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="cs2_rules.html">Rules</a>
    </li>
    <li>
      <a href="cs2_lab01.html">Instruction I</a>
    </li>
    <li>
      <a href="cs2_lab02.html">Instruction II</a>
    </li>
    <li>
      <a href="cs2_lab03.html">Instruction III</a>
    </li>
    <li>
      <a href="cs2_lab04.html">Instruction IV</a>
    </li>
    <li>
      <a href="cs2_lab05.html">Instruction V</a>
    </li>
    <li>
      <a href="cs2_lab06.html">Instruction VI</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Info III
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="info3_informacje.html">Regulamin i Informacje</a>
    </li>
    <li>
      <a href="info3_lab_1.html">Instrukcja I</a>
    </li>
    <li>
      <a href="info3_lab_2-3.html">Instrukcja II - III</a>
    </li>
    <li>
      <a href="info3_lab_4.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="info3_lab_5.html">Instrukcja V</a>
    </li>
    <li>
      <a href="info3_lab_6.html">Instrukcja VI</a>
    </li>
    <li>
      <a href="info3_lab_7.html">Instrukcja VII</a>
    </li>
    <li>
      <a href="info3_lab_dodatki.html">Bash: Dodatki</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Met Num
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="metnum_regulamin.html">Regulamin</a>
    </li>
    <li>
      <a href="metnum_lab1.html">Instrukcja I</a>
    </li>
    <li>
      <a href="metnum_lab2.html">Instrukcja II</a>
    </li>
    <li>
      <a href="metnum_lab3.html">Instrukcja III</a>
    </li>
    <li>
      <a href="metnum_lab4.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="metnum_lab5.html">Instrukcja V</a>
    </li>
    <li>
      <a href="metnum_lab6.html">Instrukcja VI</a>
    </li>
    <li>
      <a href="metnum_lab7.html">Instrukcja VII</a>
    </li>
    <li>
      <a href="metnum_projekty.html">Projekty</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Skrypt</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="metnum_skrypt02.html">Metody Iteracyjne</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    C++
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="cpp_rules.html">Regulamin przedmiotu</a>
    </li>
    <li>
      <a href="cpp_inst01.html">Instrukcja I</a>
    </li>
    <li>
      <a href="cpp_inst02.html">Instrukcja II</a>
    </li>
    <li>
      <a href="cpp_inst03.html">Instrukcja III</a>
    </li>
    <li>
      <a href="cpp_inst04.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="cpp_inst05.html">Instrukcja V</a>
    </li>
    <li>
      <a href="cpp_inst06.html">Instrukcja VI</a>
    </li>
    <li>
      <a href="cpp_inst07.html">Instrukcja VII</a>
    </li>
    <li>
      <a href="cpp_projects.html">Lista projektów</a>
    </li>
    <li>
      <a href="cpp_old_link.html">Stare materiały</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Python
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="python_inst01.html">Instrukcja I</a>
    </li>
    <li>
      <a href="python_inst02.html">Instrukcja II</a>
    </li>
    <li>
      <a href="python_inst03.html">Instrukcja III</a>
    </li>
    <li>
      <a href="python_inst04.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="python_inst05.html">Instrukcja V</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    HPC
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="hpc_resources.html">Resources</a>
    </li>
    <li>
      <a href="hpc_lab01.html">Lab 1</a>
    </li>
    <li>
      <a href="hpc_lab02.html">Lab 2</a>
    </li>
    <li>
      <a href="hpc_lab03.html">Lab 3</a>
    </li>
    <li>
      <a href="hpc_lab04.html">Lab 4-5</a>
    </li>
    <li>
      <a href="hpc_lab06.html">Lab 6</a>
    </li>
    <li>
      <a href="hpc_lab07.html">Lab 7</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    MOMP
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="momp_rules.html">Informacje</a>
    </li>
    <li>
      <a href="momp_lab01.html">Instrukcja I</a>
    </li>
    <li>
      <a href="momp_lab02.html">Instrukcja II</a>
    </li>
    <li>
      <a href="momp_lab03.html">Instrukcja III</a>
    </li>
    <li>
      <a href="momp_lab04.html">Instrukcja IV</a>
    </li>
    <li>
      <a href="momp_lab05.html">Instrukcja V</a>
    </li>
    <li>
      <a href="momp_lab06.html">Instrukcja VI</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a class="hidden">
    <span class="fa fa-file-pdf-o fa-lg"></span>
     
    PDF
  </a>
</li>
<li>
  <a href="https://github.com/ccfd/courses/edit/master/hpc_lab03.md">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
<li>
  <a href="https://en.wikipedia.org/wiki/Creative_Commons_license">
    <span class="fa fa-creative-commons fa-lg"></span>
     
    CC
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Dummy header -->

<div id="header">



<h1 class="title toc-ignore">Lab 3</h1>
<h4 class="author">J. Gałecki</h4>

</div>


<div id="lab-iii" class="section level1">
<h1>Lab III</h1>
<div id="warmup-vector-reduction" class="section level2">
<h2>Warmup – vector reduction</h2>
<p>Create an array of random floating point values. The length of the
array should be the benchmark parameter. Compute their sum in the
following ways:</p>
<ol style="list-style-type: decimal">
<li><p>Use <code>makeRandomVector</code> to create the array (in this
case, wrapped in a <code>std::vector</code>). Implement the reduction
naively, i.e., use a single accumulator and loop over the
vector.</p></li>
<li><p>Use <code>makeRandomVector</code> to create the array (in this
case, wrapped in a <code>std::vector</code>). Use a vector
register-sized accumulator and compute the reduction in a vectorized
fashion. To this end, use the compiler intrinsics appropriate for your
CPU. At the end of the loop, manually sum the entries of the accumulator
(store them to memory and do a final small loop). Since the underlying
array is only guaranteed to be aligned to the size of the floating point
value, be sure to use unaligned load/store instrinsics!</p></li>
<li><p>Repeat 2, this time using aligned storage and memory access. Use
the provided convenience function <code>makeRandomAlignedArray</code> to
ensure alignment (align to 64B to further optimize cache
behavior).</p></li>
<li><p>Compute the reduction using an aligned array and the standard
algorithm <code>std::reduce</code>.</p></li>
</ol>
<p>Compare and discuss your results.</p>
</div>
<div id="vectorizing-matrix-matrix-multiplication"
class="section level2">
<h2>Vectorizing matrix-matrix multiplication</h2>
<p>Vectorize the Goto algorithm code written during the previous class.
Assume that the underlying arrays are properly aligned (you can check
this in the initialization code). Note that only the micro-kernel needs
to be modified. Be sure to use the fused multiply-add operations.
Discuss your observations with other students. Ask the instructors for
help, if needed.</p>
</div>
<div id="introduction-to-eigen" class="section level2">
<h2>Introduction to Eigen</h2>
<div id="installation" class="section level3">
<h3>Installation</h3>
<p>Installation of Eigen is actually not required, as it is a
header-only library. Simply download the source code from <a
href="https://gitlab.com/libeigen/eigen/">Gitlab</a> and include the
requisite headers. If you’re using <code>spack</code>,
<code>spack install eigen</code> will do the trick (just remember to use
the corresponding <code>load</code> command). The functionality
discussed herein is contained within the <code>Eigen/Dense</code>
header. Be sure to have the <a
href="https://eigen.tuxfamily.org/dox/group__QuickRefPage.html">quick
reference page</a> open.</p>
</div>
<div id="eigenmatrix" class="section level3">
<h3><code>Eigen::Matrix</code></h3>
<p><code>Matrix</code> is the foundation of Eigen. It is a template used
to represent matrices. The type of the values stored in the matrix, as
well as its size are given by the template parameters. For example,
<code>Eigen::Matrix&lt;double, 4, 6&gt;</code> is a type representing a
4x6 matrix of values of type <code>double</code>. If the size of the
matrix is unknown at compile time, the special value
<code>Eigen::Dynamic</code> can be used. The matrix manages its own
storage, meaning that no manual memory management is required from the
user. Some convenience typedefs are provided by the library, for
example:</p>
<ul>
<li><code>Eigen::Matrix3d</code> &lt;=&gt;
<code>Eigen::Matrix&lt;double, 3, 3&gt;</code></li>
<li><code>Eigen::MatrixXd</code> &lt;=&gt;
<code>Eigen::Matrix&lt;double, Eigen::Dynamic, Eigen::Dynamic&gt;</code></li>
<li><code>Eigen::VectorXd</code> &lt;=&gt;
<code>Eigen::Matrix&lt;double, Eigen::Dynamic, 1&gt;</code></li>
</ul>
<p>The matrix entries are uninitialized by default. You can access them
using <code>operator()</code>, leading to Matlab-like code. Note that
Eigen uses 0-based indexing. For example:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>Eigen<span class="op">::</span>Matrix3d mat<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>mat<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">3.14</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>mat<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1.</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>mat<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">=</span> <span class="fl">42.</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> mat<span class="op">;</span> <span class="co">// note the support for iostreams</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">// diagonal initialized, off-diagonal entries contain garbage from memory</span></span></code></pre></div>
<p>Initialization to some common cases can be done as follows</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Eigen<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>MatrixXd m1 <span class="op">=</span> MatrixXd<span class="op">::</span>Zeros<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">12</span><span class="op">);</span> <span class="co">// dynamic size =&gt; dimensions needed</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>Matrix3d m2 <span class="op">=</span> Matrix3d<span class="op">::</span>Ones<span class="op">();</span>        <span class="co">// static size =&gt; dimensions inferred</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>Vector4d v1 <span class="op">=</span> Vector4d<span class="op">::</span>Random<span class="op">();</span></span></code></pre></div>
<p>Alternatively, you can use the <code>setX</code> methods:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m1<span class="op">.</span>setZero<span class="op">();</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>m2<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>m3<span class="op">.</span>setRandom<span class="op">();</span></span></code></pre></div>
</div>
<div id="eigen-arithmetic" class="section level3">
<h3>Eigen arithmetic</h3>
<p>Arithmetic in Eigen is defined in terms of the usual operators:
<code>+</code>, <code>-</code>, <code>*</code>, etc. The only catch is
that operators don’t return matrices, but proxy objects, which can be
converted into matrices using the appropriate constructor or assignment
operator. What this means in practice is that we can’t use
<code>auto</code> when creating new matrices:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">auto</span> mat3 <span class="op">=</span> mat1 <span class="op">*</span> mat2<span class="op">;</span> <span class="co">// the deduced type is not a matrix, but a proxy type</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">// Instead do</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>Matrix<span class="op">&lt;...&gt;</span> mat3 <span class="op">=</span> mat1 <span class="op">*</span> mat2<span class="op">;</span></span></code></pre></div>
<p>The reason for this behavior is that it allows optimization on chain
expressions, e.g.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>mat4 <span class="op">=</span> mat1 <span class="op">*</span> mat2 <span class="op">+</span> mat3<span class="op">;</span></span></code></pre></div>
<p>would normally first evaluate the product of <code>mat1</code> and
<code>mat2</code>, and then sum the temporary result with
<code>mat3</code>. Instead, some optimizations can be performed, e.g.,
writing the result of the temporary product to <code>mat4</code> and
then doing the sum in-place. This does not meaningfully impact usage
(other than not being able to use <code>auto</code>), but it is worth
knowing about.</p>
<p>Transpositions are done as follows</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>c <span class="op">=</span> a<span class="op">.</span>transpose<span class="op">()</span> <span class="op">*</span> b<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>d<span class="op">.</span>transposeInPlace<span class="op">();</span></span></code></pre></div>
</div>
<div id="algebraic-solvers" class="section level3">
<h3>Algebraic solvers</h3>
<p>The final feature of Eigen that we will mention is solving systems of
algebraic equations. In Matlab, this is simply done using the
<code>\</code> operator, which selects an algorithm based on some
heuristic. In Eigen, we need to explicitly specify which solver we’d
like to call. The full list is available <a
href="https://eigen.tuxfamily.org/dox/group__TutorialLinearAlgebra.html">here</a>.
The syntax is as follows</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">// Solve random 5x5 system of equations</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>Matrix<span class="op">&lt;</span><span class="dt">double</span><span class="op">,</span> n<span class="op">,</span> n<span class="op">&gt;</span> A<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>Matrix<span class="op">&lt;</span><span class="dt">double</span><span class="op">,</span> n<span class="op">,</span> <span class="dv">1</span><span class="op">&gt;</span> b<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>A<span class="op">.</span>setRandom<span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>b<span class="op">.</span>setRandom<span class="op">();</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">// Householder rank-revealing QR decomposition of a matrix with column-pivoting.</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="dt">vec_t</span> x <span class="op">=</span> A<span class="op">.</span>colPivHouseholderQr<span class="op">().</span>solve<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;A:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> A<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;b:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> b<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Ax = b =&gt; x:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> x<span class="op">;</span></span></code></pre></div>
</div>
<div id="notes" class="section level3">
<h3>Notes</h3>
<ul>
<li><p>Eigen is highly optimized for multiple architectures. The code is
vectorized. Feel free to confirm this by comparing its performance with
that of your own code.</p></li>
<li><p>Eigen is multi-threaded by default, assuming you link your
executable with OpenMP (by passing <code>-fopenmp</code> to the
compiler). To disable this (e.g. for the purpose of comparison with
non-multi-threaded code), define the <code>EIGEN_DONT_PARALLELIZE</code>
macro before including the library headers (or just don’t link with
OpenMP).</p></li>
<li><p>Eigen has many interesting features that were not covered here.
Examples include eigensolvers and sparse matrix support. Feel free to
explore these, especially for the purposes of your projects.</p></li>
<li><p>Eigen is open-source and developed by volunteers. Consider
contributing!</p></li>
</ul>
</div>
<div id="problems-for-self-study" class="section level3">
<h3>Problems for self-study</h3>
<ol style="list-style-type: decimal">
<li><p>Compare the performance of your matrix-matrix product with that
of Eigen</p></li>
<li><p>Implement the <a
href="https://en.wikipedia.org/wiki/Power_iteration">power
method</a></p></li>
<li><p>Consider how you can use Eigen in your project</p></li>
</ol>
</div>
</div>
</div>

<!-- Dummy footer -->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
